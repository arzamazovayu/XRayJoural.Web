@page "/"
@rendermode InteractiveAuto

<PageTitle>Home</PageTitle>

<div class="container" style="margin-bottom:15px;">
    <InputText @bind-Value="searchText"> </InputText>
    <button @onclick="OnFilter">Поиск</button>

    <InputSelect @bind-Value="searchSex">
        <option value="">Не определён</option>
        <option value="Муж">Муж</option>
        <option value="Жен">Жен</option>
    </InputSelect>
</div>


<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th scope="col">№</th>
            <th scope="col">Фамилия</th>
            <th scope="col">Имя</th>
            <th scope="col">Отчество</th>
            <th scope="col">Пол</th>
            <th scope="col">Дата рождения</th>
            <th scope="col">ID пациента</th>
            @*  <th scope="col">Исследование</th>
            <th scope="col">Доза</th>
            <th scope="col">Снимков/серий</th>
            <th scope="col">Дата исс-я</th>
            <th scope="col">Категория</th>
            <th scope="col">Диагноз</th>
            <th scope="col">Патология</th>
            <th scope="col">Стоимость</th>
            <th scope="col">Врач</th>
            <th scope="col">Лаборант</th>
            <th scope="col">Модальность</th>
            <th scope="col">В операционной</th>
            <th scope="col">Контраст</th> *@
        </tr>
    </thead>
    <tbody>
        @foreach (var p in selectedPatients)
        {
            <MainTable Patient="p"></MainTable>
        }
        @*  @foreach (var e in XRayService.GetAllExams())
        {
            <MainTable Exam="e"></MainTable>
        } *@
    </tbody>
</table>
@code{
    [Inject] 
    public PatientService PatientService { get; set; }

    // [Inject] 
    // public XRayExamService XRayService { get; set; }

    private string searchText;
    private string searchSex;

    private List<PatientOutputModel> patients;

    private List<PatientOutputModel> selectedPatients;

    protected override void OnInitialized()
    {
        patients = PatientService.GetAll();
        selectedPatients = patients;
    }

    private void OnFilter()
    {
        string tmp = searchText.Trim().ToLower();
        selectedPatients = patients.Where(p => p.SecondName.ToLower().Contains(tmp)).ToList();

        // selectedPatients = patients.Where(p => p.SecondName.ToLower().Contains(tmp)).ToList();
        // selectedPatients = patients.Where(p => p.FirstName.ToLower().Contains(tmp)).ToList();
        // selectedPatients = patients.Where(p => p.ThirdName.ToLower().Contains(tmp)).ToList();
        // selectedPatients = patients.Where(p => p.MedNumber.ToLower().Contains(tmp)).ToList();
        // selectedPatients = patients.Where(p => p.BirthDate.ToString().Contains(tmp)).ToList();

        // if (searchSex!="Не определён")
        // {
        //     string a = searchSex.Trim().ToLower();
        //     selectedPatients = selectedPatients.Where(p => p.Sex.ToLower().Contains(a)).ToList(); // 1:35:54
        // }

        StateHasChanged();
    }

}